{% extends 'polls/base.html' %}

{% block content %}
<div class="card">
    <h2 style="margin-top: 0;">{{ question.question_text }}</h2>

    {% if question.image %}
        <div style="text-align: center; margin: 15px 0;">
            <img src="{{ question.image.url }}" style="max-width: 100%; max-height: 300px; border-radius: 4px;" alt="Изображение опроса">
        </div>
    {% endif %}

    {% if question.description %}
        <div style="background: #f8f9fa; padding: 15px; border-radius: 4px; margin-bottom: 20px;">
            <h3 style="margin-top: 0;">Описание:</h3>
            <p>{{ question.description }}</p>
        </div>
    {% endif %}

    <div style="font-size: 14px; color: #666; margin-bottom: 20px;">
        <div>Автор: {% if question.author %}{{ question.author.username }}{% else %}Неизвестен{% endif %}</div>
        <div>Опубликован: {{ question.pub_date|date:"d.m.Y H:i" }}</div>
        {% if question.end_date %}
            <div>Завершится: {{ question.end_date|date:"d.m.Y H:i" }}</div>
        {% endif %}
    </div>

    {% if not question.is_active %}
        <div style="background: #fff3cd; color: #856404; padding: 10px; border-radius: 4px; margin-bottom: 20px;">
            Этот опрос завершен. Голосование невозможно.
        </div>
    {% endif %}

    {% if user_voted %}
        <div style="background: #d1ecf1; color: #0c5460; padding: 10px; border-radius: 4px; margin-bottom: 20px;">
            Вы уже голосовали в этом опросе.
            <a href="{% url 'polls:results' question.id %}" style="display: block; margin-top: 5px;">Посмотреть результаты</a>
        </div>
    {% elif question.is_active %}
        <h3>Выберите вариант:</h3>

        <form action="{% url 'polls:vote' question.id %}" method="post">
            {% csrf_token %}

            {% for choice in question.choice_set.all %}
                <div style="margin-bottom: 10px; padding: 10px; border: 1px solid #dee2e6; border-radius: 4px;">
                    <input type="radio" name="choice" id="choice{{ forloop.counter }}" value="{{ choice.id }}">
                    <label for="choice{{ forloop.counter }}" style="margin-left: 5px;">{{ choice.choice_text }}</label>
                </div>
            {% endfor %}

            <div style="margin-top: 20px;">
                <button type="submit" class="btn">Проголосовать</button>
            </div>
        </form>
    {% endif %}

    <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #dee2e6;">
        <a href="{% url 'polls:results' question.id %}" class="btn">Результаты</a>
        <a href="{% url 'polls:index' %}" class="btn btn-secondary">Назад к опросам</a>
    </div>
</div>
{% endblock %}